<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyFlix Demo - Home (Demo Project)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #0A2647;
            color: #fff;
            overflow-x: hidden;
        }


        /* Navigation */
        .navbar {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 20px 60px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            background: linear-gradient(to bottom, rgba(10, 38, 71, 0.95), transparent);
            transition: background 0.3s;
        }

        .navbar.scrolled {
            background: #0A2647;
        }

        .logo {
            color: #2C74B3;
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: -1px;
            text-decoration: none;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-icon, .notifications-icon {
            font-size: 1.5rem;
            cursor: pointer;
            color: #fff;
        }

        .profile-menu {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .profile-avatar {
            width: 32px;
            height: 32px;
            background: #2C74B3;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        /* Hero Section */
        .hero {
            position: relative;
            height: 80vh;
            display: flex;
            align-items: center;
            padding: 0 60px;
            margin-top: 70px;
            overflow: hidden;
        }

        .hero-video {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            object-fit: contain; /* show full video, no cropping */
            transform: translate(-50%, -50%);
            z-index: 0;
            background-color: #000; /* letterbox bars if needed */
        }

        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.4));
            z-index: 1;
        }

        .hero-content {
            max-width: 600px;
            z-index: 2;
            position: relative;
        }

        .hero-title {
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .hero-description {
            font-size: 1.2rem;
            margin-bottom: 30px;
            line-height: 1.6;
            color: #d2d2d2;
        }

        .hero-buttons {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .btn-play {
            background: #fff;
            color: #000;
        }

        .btn-play:hover {
            background: #e6e6e6;
        }

        .btn-info {
            background: rgba(109, 109, 110, 0.7);
            color: #fff;
        }

        .btn-info:hover {
            background: rgba(109, 109, 110, 0.4);
        }

        /* Content Rows */
        .content-section {
            padding: 40px 60px;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #e5e5e5;
        }

        .row {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 20px;
            scrollbar-width: none;
        }

        .row::-webkit-scrollbar {
            display: none;
        }

        .movie-card {
            min-width: 200px;
            height: 300px;
            background: #144272;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }

        .movie-card:hover {
            transform: scale(1.15) translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.9);
            z-index: 100;
        }

        .video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.3s;
        }

        .movie-card:hover .video-thumbnail {
            opacity: 0.7;
        }

        .video-preview {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .movie-card:hover .video-preview {
            opacity: 1;
        }

        .play-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            opacity: 0;
            transition: all 0.3s;
            z-index: 10;
        }

        .movie-card:hover .play-overlay {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1.1);
        }

        /* Movie Details Modal */
        .details-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .details-modal.active {
            display: flex;
            opacity: 1;
        }

        .details-container {
            position: relative;
            width: 90%;
            max-width: 900px;
            background: #0A2647;
            border-radius: 8px;
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }

        .details-header {
            position: relative;
            height: 400px;
            background-size: cover;
            background-position: center;
        }

        .details-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, #0A2647, transparent);
        }

        .details-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: #fff;
            font-size: 2rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s;
        }

        .details-close:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: rotate(90deg);
        }

        .details-content {
            position: relative;
            padding: 40px;
            margin-top: -100px;
            z-index: 5;
        }

        .details-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .details-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .meta-item {
            font-size: 1rem;
            color: #46d369;
            font-weight: 600;
        }

        .meta-item.year {
            color: #fff;
        }

        .meta-item.rating {
            color: #fff;
        }

        .details-description {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #d2d2d2;
        }

        .details-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .details-btn {
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .details-btn-play {
            background: #2C74B3;
            color: #fff;
        }

        .details-btn-play:hover {
            background: #205295;
        }

        .details-btn-info {
            background: rgba(20, 66, 114, 0.9);
            color: #fff;
        }

        .details-btn-info:hover {
            background: rgba(32, 82, 149, 0.9);
        }

        /* Footer */
        .footer {
            padding: 40px 60px 20px;
            color: #d0e4ff;
            border-top: 1px solid #144272;
            background: #0A2647;
            font-size: 0.875rem;
        }

        .footer-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .footer-top {
            margin-bottom: 30px;
        }

        .footer-top a {
            color: #737373;
            text-decoration: none;
        }

        .footer-top a:hover {
            text-decoration: underline;
        }

        .footer-links {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .footer-links a {
            color: #d0e4ff;
            text-decoration: none;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        .footer-bottom {
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .footer {
                padding: 30px 20px 20px;
            }

            .footer-links {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Video Modal */
        .video-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .video-modal.active {
            display: flex;
        }

        .video-container {
            position: relative;
            width: 90%;
            max-width: 1200px;
            aspect-ratio: 16/9;
        }

        .video-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .close-video {
            position: absolute;
            top: -40px;
            right: 0;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 2rem;
            cursor: pointer;
            padding: 10px;
        }

        .close-video:hover {
            color: #e50914;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .navbar {
                padding: 15px 20px;
            }

            .hero {
                height: 60vh;
                padding: 0 20px;
            }

            .hero-title {
                font-size: 2.5rem;
            }

            .hero-description {
                font-size: 1rem;
            }

            .content-section {
                padding: 30px 20px;
            }

            .movie-card {
                min-width: 150px;
                height: 225px;
            }

            .details-container {
                width: 95%;
            }

            .details-header {
                height: 300px;
            }

            .details-content {
                padding: 20px;
            }

            .details-title {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <a href="index.html" class="logo">MYFLIX DEMO</a>
        <div class="nav-right">
            <div class="search-icon">üîç</div>
            <div class="notifications-icon">üîî</div>
            <div class="profile-menu">
                <div class="profile-avatar">U</div>
                <span>‚ñº</span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <video class="hero-video" autoplay muted loop playsinline>
            <source src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <h1 class="hero-title">Stranger Things</h1>
            <p class="hero-description">
                When a young boy vanishes, a small town uncovers a mystery involving 
                secret experiments, terrifying supernatural forces and one strange little girl.
            </p>
            <div class="hero-buttons">
                <!-- Main play button uses your first YouTube link -->
                <button class="btn btn-play" onclick="playVideo('OwQqisXFjHk')">‚ñ∂ Play</button>
                <button class="btn btn-info" onclick="showDetails({id: 'OwQqisXFjHk', title: 'Custom Video 1', year: '2024', rating: 'PG', description: 'Your custom video from YouTube.', genre: 'Custom'})">‚Ñπ More Info</button>
            </div>
        </div>
    </section>

    <!-- Movie Details Modal -->
    <div class="details-modal" id="detailsModal">
        <div class="details-container">
            <div class="details-header" id="detailsHeader"></div>
            <button class="details-close" onclick="closeDetails()">&times;</button>
            <div class="details-content">
                <h2 class="details-title" id="detailsTitle"></h2>
                <div class="details-meta" id="detailsMeta"></div>
                <p class="details-description" id="detailsDescription"></p>
                <div class="details-buttons">
                    <button class="details-btn details-btn-play" id="detailsPlayBtn">
                        ‚ñ∂ Play
                    </button>
                    <button class="details-btn details-btn-info">
                        ‚Ñπ More Info
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Modal -->
    <div class="video-modal" id="videoModal">
        <div class="video-container">
            <button class="close-video" onclick="closeVideo()">&times;</button>
            <iframe id="videoPlayer" src="" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
    </div>

    <!-- Content Rows -->
    <div class="content-section">
        <h2 class="section-title">Trending Now</h2>
        <div class="row" id="trendingRow"></div>
    </div>

    <div class="content-section">
        <h2 class="section-title">Popular on MyFlix Demo</h2>
        <div class="row" id="popularRow"></div>
    </div>

    <div class="content-section">
        <h2 class="section-title">Continue Watching</h2>
        <div class="row" id="continueRow"></div>
    </div>

    <div class="content-section">
        <h2 class="section-title">Top Rated</h2>
        <div class="row" id="topRatedRow"></div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-top">
                <a href="#">Questions? Contact us.</a>
            </div>
            <div class="footer-links">
                <a href="#">FAQ</a>
                <a href="#">Help Center</a>
                <a href="#">Account</a>
                <a href="#">Media Center</a>
                <a href="#">Investor Relations</a>
                <a href="#">Jobs</a>
                <a href="#">Ways to Watch</a>
                <a href="#">Terms of Use</a>
                <a href="#">Privacy</a>
                <a href="#">Cookie Preferences</a>
                <a href="#">Corporate Information</a>
                <a href="#">Contact Us</a>
                <a href="#">Speed Test</a>
                <a href="#">Legal Notices</a>
                <a href="#">Only on MyFlix Demo (not affiliated with Netflix)</a>
            </div>
            <div class="footer-bottom">
                <p>MyFlix Demo &mdash; Unofficial Netflix-style clone</p>
            </div>
        </div>
    </footer>

    <script>
        const API_BASE = 'http://localhost:5000/api';

        function getAuthToken() {
            return localStorage.getItem('myflix_token');
        }

        function getStoredUser() {
            try {
                const raw = localStorage.getItem('myflix_user');
                return raw ? JSON.parse(raw) : null;
            } catch (e) {
                return null;
            }
        }

        // Create a card from backend video data
        function createVideoCard(video, container) {
            const card = document.createElement('div');
            card.className = 'movie-card';
            card.onclick = () => showDetails(video);

            const thumbnail = document.createElement('img');
            thumbnail.className = 'video-thumbnail';

            if (video.externalUrl && video.externalUrl.includes('youtube')) {
                // Try to derive YouTube thumbnail from URL
                const idMatch = video.externalUrl.match(/[?&]v=([^&#]+)/) || video.externalUrl.match(/youtu.be\/(.+)$/);
                const ytId = idMatch ? idMatch[1] : null;
                if (ytId) {
                    thumbnail.src = `https://img.youtube.com/vi/${ytId}/hqdefault.jpg`;
                } else {
                    thumbnail.src = 'https://via.placeholder.com/400x300?text=Video';
                }
            } else {
                // Uploaded video or non-YouTube link: use placeholder
                thumbnail.src = 'https://via.placeholder.com/400x300?text=Video';
            }

            thumbnail.alt = video.title;

            const playOverlay = document.createElement('div');
            playOverlay.className = 'play-overlay';
            playOverlay.innerHTML = '‚ñ∂';

            card.appendChild(thumbnail);
            card.appendChild(playOverlay);
            container.appendChild(card);
        }

        // Show details modal for a backend video
        function showDetails(video) {
            const modal = document.getElementById('detailsModal');
            const header = document.getElementById('detailsHeader');
            const title = document.getElementById('detailsTitle');
            const meta = document.getElementById('detailsMeta');
            const description = document.getElementById('detailsDescription');
            const playBtn = document.getElementById('detailsPlayBtn');

            // Background image: reuse YouTube thumbnail when possible, otherwise solid color
            if (video.externalUrl && video.externalUrl.includes('youtube')) {
                const idMatch = video.externalUrl.match(/[?&]v=([^&#]+)/) || video.externalUrl.match(/youtu.be\/(.+)$/);
                const ytId = idMatch ? idMatch[1] : null;
                if (ytId) {
                    header.style.backgroundImage = `url(https://img.youtube.com/vi/${ytId}/maxresdefault.jpg)`;
                } else {
                    header.style.backgroundImage = 'linear-gradient(135deg, #144272, #2C74B3)';
                }
            } else {
                header.style.backgroundImage = 'linear-gradient(135deg, #144272, #2C74B3)';
            }

            title.textContent = video.title;

            meta.innerHTML = `
                <span class="meta-item">${video.views || 0} views</span>
            `;

            description.textContent = video.description || '';

            playBtn.onclick = () => {
                closeDetails();
                setTimeout(() => {
                    playVideo(video);
                }, 300);
            };

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeDetails() {
            const modal = document.getElementById('detailsModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Play either uploaded or external video
        function playVideo(video) {
            const modal = document.getElementById('videoModal');
            const player = document.getElementById('videoPlayer');

            let src;
            if (video.filePath) {
                // Stream from backend
                src = `http://localhost:5000/api/videos/${video._id}/stream`;
            } else if (video.externalUrl) {
                src = video.externalUrl;
            }

            if (!src) {
                return;
            }

            player.src = src;
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';

            // Increment view count for external URLs
            if (!video.filePath) {
                fetch(`${API_BASE}/videos/${video._id}/view`, { method: 'POST' }).catch(() => {});
            }
        }

        function closeVideo() {
            const modal = document.getElementById('videoModal');
            const player = document.getElementById('videoPlayer');
            modal.classList.remove('active');
            player.src = '';
            document.body.style.overflow = 'auto';
        }

        async function ensureAuthenticated() {
            const token = getAuthToken();
            if (!token) {
                window.location.href = 'pages/netflix.html';
                return null;
            }

            try {
                const res = await fetch(`${API_BASE}/auth/me`, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                if (!res.ok) {
                    throw new Error('Not authenticated');
                }
                const data = await res.json();
                const user = data.user;
                localStorage.setItem('myflix_user', JSON.stringify(user));
                return user;
            } catch (e) {
                localStorage.removeItem('myflix_token');
                localStorage.removeItem('myflix_user');
                window.location.href = 'pages/netflix.html';
                return null;
            }
        }

        async function loadVideos() {
            try {
                const res = await fetch(`${API_BASE}/videos`);
                const data = await res.json();
                const videos = data.videos || [];

                const trendingRow = document.getElementById('trendingRow');
                const popularRow = document.getElementById('popularRow');
                const continueRow = document.getElementById('continueRow');
                const topRatedRow = document.getElementById('topRatedRow');

                videos.forEach(video => {
                    createVideoCard(video, trendingRow);
                    createVideoCard(video, popularRow);
                    createVideoCard(video, continueRow);
                    createVideoCard(video, topRatedRow);
                });
            } catch (e) {
                console.error('Failed to load videos', e);
            }
        }

        window.addEventListener('DOMContentLoaded', async function() {
            const user = await ensureAuthenticated();
            if (!user) return;

            const profileAvatar = document.querySelector('.profile-avatar');
            if (profileAvatar && user.name) {
                profileAvatar.textContent = user.name.charAt(0).toUpperCase();
            }

            await loadVideos();
        });

        // Logout functionality
        document.querySelector('.profile-menu').addEventListener('click', function() {
            if (confirm('Do you want to sign out?')) {
                localStorage.removeItem('myflix_token');
                localStorage.removeItem('myflix_user');
                window.location.href = 'pages/netflix.html';
            }
        });

        // Navbar scroll effect
        window.addEventListener('scroll', function() {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 50) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        // Smooth scroll for rows
        document.querySelectorAll('.row').forEach(row => {
            let isDown = false;
            let startX;
            let scrollLeft;

            row.addEventListener('mousedown', (e) => {
                isDown = true;
                startX = e.pageX - row.offsetLeft;
                scrollLeft = row.scrollLeft;
            });

            row.addEventListener('mouseleave', () => {
                isDown = false;
            });

            row.addEventListener('mouseup', () => {
                isDown = false;
            });

            row.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                const x = e.pageX - row.offsetLeft;
                const walk = (x - startX) * 2;
                row.scrollLeft = scrollLeft - walk;
            });
        });

        // Close modals on background / ESC
        document.getElementById('detailsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeDetails();
            }
        });

        document.getElementById('videoModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeVideo();
            }
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeDetails();
                closeVideo();
            }
        });
    </script>
</body>
</html>
